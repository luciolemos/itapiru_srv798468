{% extends 'layouts/base.twig' %}

{% block title %}Contato | Dashboard Público{% endblock %}

{% block content %}
<div class="db-shell">
  <aside id="db-sidebar" class="db-sidebar" data-sidebar aria-label="Menu de seções">
    <div class="db-sidebar-header">
      <img
        class="db-om-logo"
        src="{{ asset_base_path }}/assets/img/om.png"
        alt="Imagem institucional"
      >
      <h1 class="db-brand">16º BI Mtz</h1>
      <p class="db-caption">Batalhão Itapiru</p>
    </div>

    <nav class="db-menu" aria-label="Navegação de seções">
      <a href="/itapiru" hx-boost="false" class="db-menu-item{{ activeSection == 'home' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'home' ? 'page' : 'false' }}">
        Início
      </a>
      <span class="db-menu-divider" aria-hidden="true"></span>
      {% set sidebarGroups = groupedSections|default([]) %}
      {% for group in sidebarGroups %}
        {% set groupSlugs = group.items|keys %}
        {% set isGroupOpen = loop.first or (activeSection is defined and activeSection in groupSlugs) %}
        <section class="db-menu-group-block" data-menu-group>
          <button
            type="button"
            class="db-menu-group-toggle"
            data-menu-group-toggle
            data-group-key="group-{{ loop.index0 }}-{{ group.label|lower|trim|replace({' ': '-'}) }}"
            aria-expanded="{{ isGroupOpen ? 'true' : 'false' }}"
          >
            <span class="db-menu-group">{{ group.label|label_case }}</span>
            <i class="bi bi-chevron-down" aria-hidden="true"></i>
          </button>
          <div class="db-menu-group-items" data-menu-group-items {{ isGroupOpen ? '' : 'hidden' }}>
            {% for slug, section in group.items %}
              <a
                href="/itapiru/{{ slug }}"
                hx-boost="false"
                class="db-menu-item{{ activeSection == slug ? ' is-active' : '' }}"
                aria-current="{{ activeSection == slug ? 'page' : 'false' }}"
              >
                {{ section.label|label_case }}
              </a>
              {% if not loop.last %}
                <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
              {% endif %}
            {% endfor %}
          </div>
        </section>
        {% if not loop.last %}
          <span class="db-menu-divider" aria-hidden="true"></span>
        {% endif %}
      {% endfor %}
      <span class="db-menu-divider" aria-hidden="true"></span>
      {% set isDocsMenuOpen = activeSection in ['readme', 'readme-seed', 'readme-sqlite'] %}
      <section class="db-menu-group-block" data-menu-group>
        <button
          type="button"
          class="db-menu-group-toggle"
          data-menu-group-toggle
          data-group-key="docs-menu"
          aria-expanded="{{ isDocsMenuOpen ? 'true' : 'false' }}"
        >
          <span class="db-menu-group">Documentação</span>
          <i class="bi bi-chevron-down" aria-hidden="true"></i>
        </button>
        <div class="db-menu-group-items" data-menu-group-items {{ isDocsMenuOpen ? '' : 'hidden' }}>
          <a href="/itapiru/readme" hx-boost="false" class="db-menu-item{{ activeSection == 'readme' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme' ? 'page' : 'false' }}">
            Guia do usuário
          </a>
          <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
          <a href="/itapiru/readme-seed" hx-boost="false" class="db-menu-item{{ activeSection == 'readme-seed' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme-seed' ? 'page' : 'false' }}">
            Guia de Seed
          </a>
          <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
          <a href="/itapiru/readme-sqlite" hx-boost="false" class="db-menu-item{{ activeSection == 'readme-sqlite' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme-sqlite' ? 'page' : 'false' }}">
            Guia do banco
          </a>
        </div>
      </section>
      <span class="db-menu-divider" aria-hidden="true"></span>
      <a href="/itapiru/contato" hx-boost="false" class="db-menu-item{{ activeSection == 'contato' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'contato' ? 'page' : 'false' }}">
        Contato
      </a>
      {% if isAdminLogged|default(false) %}
        <span class="db-menu-divider" aria-hidden="true"></span>
        {% set isAdminMenuOpen = activeSection == 'admin' %}
        <section class="db-menu-group-block" data-menu-group>
          <button
            type="button"
            class="db-menu-group-toggle"
            data-menu-group-toggle
            data-group-key="admin-menu"
            aria-expanded="{{ isAdminMenuOpen ? 'true' : 'false' }}"
          >
            <span class="db-menu-group">Admin</span>
            <i class="bi bi-chevron-down" aria-hidden="true"></i>
          </button>
          <div class="db-menu-group-items" data-menu-group-items {{ isAdminMenuOpen ? '' : 'hidden' }}>
            <a href="/itapiru/admin?entity=groups" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('groups') == 'groups' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('groups') == 'groups' ? 'page' : 'false' }}">
              Grupos
            </a>
            <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
            <a href="/itapiru/admin?entity=subgroups" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('') == 'subgroups' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('') == 'subgroups' ? 'page' : 'false' }}">
              Subgrupos
            </a>
            <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
            <a href="/itapiru/admin?entity=cards" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('') == 'cards' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('') == 'cards' ? 'page' : 'false' }}">
              Cards
            </a>
          </div>
        </section>
        <form method="post" action="/itapiru/logout" hx-boost="false" class="db-menu-form">
          <input type="hidden" name="csrf_token" value="{{ csrfToken|default('') }}">
          <button class="db-menu-item" type="submit">Sair</button>
        </form>
      {% else %}
        <span class="db-menu-divider" aria-hidden="true"></span>
        <a href="/itapiru/login" hx-boost="false" class="db-menu-item{{ activeSection == 'login' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'login' ? 'page' : 'false' }}">
          Login
        </a>
      {% endif %}
    </nav>
  </aside>
  <div class="db-sidebar-backdrop" data-sidebar-backdrop aria-hidden="true"></div>

  <main class="db-main" aria-label="Contato interno do dashboard">
    {% include 'components/dashboard-topbar.twig' with {
      lastUpdated: lastUpdated,
      breadcrumbs: [
        { label: 'Dashboard', url: '/itapiru' },
        { label: 'Contato' }
      ]
    } %}

    <div id="db-content" class="db-main-body">
      {% include 'components/dashboard-content-header.twig' with {
        breadcrumbs: [
          { label: 'Dashboard', url: '/itapiru' },
          { label: 'Contato' }
        ],
        title: 'Contato interno',
        subtitle: 'Canais oficiais de contato e suporte do dashboard'
      } %}

      <article class="db-card db-card--standard db-readme-card db-contact-card" aria-label="Formulário de contato">
        <p class="db-contact-intro">
          Use o formulário para dúvidas, correções de conteúdo e suporte operacional do dashboard.
        </p>

        {% if formSuccess %}
          <div class="db-form-alert is-success" role="status" aria-live="polite">
            Mensagem enviada com sucesso.
          </div>
        {% endif %}

        {% if formErrors is defined and formErrors is not empty %}
          <div class="db-form-alert is-error" role="alert">
            Corrija os campos destacados para enviar sua mensagem.
          </div>
        {% endif %}

        <form class="db-contact-form" method="post" action="/itapiru/contato" novalidate>
          <label class="db-hp-field" aria-hidden="true">
            <span>Website</span>
            <input
              type="text"
              name="website"
              value="{{ formData.website|default('') }}"
              tabindex="-1"
              autocomplete="off"
            >
          </label>

          <div class="db-form-grid">
            <label class="db-form-field">
              <span class="db-form-label">Nome</span>
              <input
                class="db-form-input{{ formErrors.name is defined ? ' is-invalid' : '' }}"
                type="text"
                name="name"
                value="{{ formData.name|default('') }}"
                placeholder="Seu nome"
                autocomplete="name"
                maxlength="120"
                required
              >
              {% if formErrors.name is defined %}
                <span class="db-form-error">{{ formErrors.name }}</span>
              {% endif %}
            </label>

            <label class="db-form-field">
              <span class="db-form-label">E-mail</span>
              <input
                class="db-form-input{{ formErrors.email is defined ? ' is-invalid' : '' }}"
                type="email"
                name="email"
                value="{{ formData.email|default('') }}"
                placeholder="nome@exemplo.mil.br"
                autocomplete="email"
                maxlength="180"
                required
              >
              {% if formErrors.email is defined %}
                <span class="db-form-error">{{ formErrors.email }}</span>
              {% endif %}
            </label>
          </div>

          <label class="db-form-field">
            <span class="db-form-label">Assunto</span>
            <input
              class="db-form-input{{ formErrors.subject is defined ? ' is-invalid' : '' }}"
              type="text"
              name="subject"
              value="{{ formData.subject|default('') }}"
              placeholder="Assunto da mensagem"
              maxlength="120"
              required
            >
            {% if formErrors.subject is defined %}
              <span class="db-form-error">{{ formErrors.subject }}</span>
            {% endif %}
          </label>

          <label class="db-form-field">
            <span class="db-form-label">Mensagem</span>
            <textarea
              class="db-form-input db-form-textarea{{ formErrors.message is defined ? ' is-invalid' : '' }}"
              name="message"
              rows="5"
              placeholder="Escreva sua mensagem"
              maxlength="1500"
              required
            >{{ formData.message|default('') }}</textarea>
            {% if formErrors.message is defined %}
              <span class="db-form-error">{{ formErrors.message }}</span>
            {% endif %}
          </label>

          <div class="db-form-actions">
            <button type="submit" class="db-card-link">Enviar mensagem</button>
          </div>
        </form>
      </article>

      {% include 'components/dashboard-footer.twig' with {
        lastUpdated: lastUpdated
      } %}
    </div>
  </main>
</div>
{% endblock %}

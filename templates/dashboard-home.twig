{% extends 'layouts/base.twig' %}

{% block title %}Dashboard Público{% endblock %}

{% block content %}
<div class="db-shell">
  <aside id="db-sidebar" class="db-sidebar" data-sidebar aria-label="Menu de seções">
    <div class="db-sidebar-header">
      <img
        class="db-om-logo"
        src="{{ asset_base_path }}/assets/img/om.png"
        alt="Imagem institucional"
      >
      <h1 class="db-brand">{{ dashboardTitle }}</h1>
      <p class="db-caption">{{ dashboardSubtitle }}</p>
    </div>

    <nav class="db-menu" aria-label="Navegação de seções">
      <a href="/itapiru" hx-boost="false" class="db-menu-item{{ activeSection == 'home' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'home' ? 'page' : 'false' }}">
        Início
      </a>
      <span class="db-menu-divider" aria-hidden="true"></span>
      {% set sidebarGroups = groupedSections|default([]) %}
      {% for group in sidebarGroups %}
        {% set groupSlugs = group.items|keys %}
        {% set isGroupOpen = loop.first or (activeSection is defined and activeSection in groupSlugs) %}
        <section class="db-menu-group-block" data-menu-group>
          <button
            type="button"
            class="db-menu-group-toggle"
            data-menu-group-toggle
            data-group-key="group-{{ loop.index0 }}-{{ group.label|lower|trim|replace({' ': '-'}) }}"
            aria-expanded="{{ isGroupOpen ? 'true' : 'false' }}"
          >
            <span class="db-menu-group">{{ group.label|label_case }}</span>
            <i class="bi bi-chevron-down" aria-hidden="true"></i>
          </button>
          <div class="db-menu-group-items" data-menu-group-items {{ isGroupOpen ? '' : 'hidden' }}>
            {% for slug, section in group.items %}
              <a
                href="/itapiru/{{ slug }}"
                hx-boost="false"
                class="db-menu-item{{ activeSection == slug ? ' is-active' : '' }}"
                aria-current="{{ activeSection == slug ? 'page' : 'false' }}"
              >
                {{ section.label|label_case }}
              </a>
              {% if not loop.last %}
                <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
              {% endif %}
            {% endfor %}
          </div>
        </section>
        {% if not loop.last %}
          <span class="db-menu-divider" aria-hidden="true"></span>
        {% endif %}
      {% endfor %}
      <span class="db-menu-divider" aria-hidden="true"></span>
      {% set isDocsMenuOpen = activeSection in ['readme', 'readme-seed', 'readme-sqlite'] %}
      <section class="db-menu-group-block" data-menu-group>
        <button
          type="button"
          class="db-menu-group-toggle"
          data-menu-group-toggle
          data-group-key="docs-menu"
          aria-expanded="{{ isDocsMenuOpen ? 'true' : 'false' }}"
        >
          <span class="db-menu-group">Documentação</span>
          <i class="bi bi-chevron-down" aria-hidden="true"></i>
        </button>
        <div class="db-menu-group-items" data-menu-group-items {{ isDocsMenuOpen ? '' : 'hidden' }}>
          <a href="/itapiru/readme" hx-boost="false" class="db-menu-item{{ activeSection == 'readme' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme' ? 'page' : 'false' }}">
            Guia do usuário
          </a>
          <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
          <a href="/itapiru/readme-seed" hx-boost="false" class="db-menu-item{{ activeSection == 'readme-seed' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme-seed' ? 'page' : 'false' }}">
            Guia de Seed
          </a>
          <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
          <a href="/itapiru/readme-sqlite" hx-boost="false" class="db-menu-item{{ activeSection == 'readme-sqlite' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'readme-sqlite' ? 'page' : 'false' }}">
            Guia do banco
          </a>
        </div>
      </section>
      <span class="db-menu-divider" aria-hidden="true"></span>
      <a href="/itapiru/contato" hx-boost="false" class="db-menu-item{{ activeSection == 'contato' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'contato' ? 'page' : 'false' }}">
        Contato
      </a>
      {% if isAdminLogged|default(false) %}
        <span class="db-menu-divider" aria-hidden="true"></span>
        {% set isAdminMenuOpen = activeSection == 'admin' %}
        <section class="db-menu-group-block" data-menu-group>
          <button
            type="button"
            class="db-menu-group-toggle"
            data-menu-group-toggle
            data-group-key="admin-menu"
            aria-expanded="{{ isAdminMenuOpen ? 'true' : 'false' }}"
          >
            <span class="db-menu-group">Admin</span>
            <i class="bi bi-chevron-down" aria-hidden="true"></i>
          </button>
          <div class="db-menu-group-items" data-menu-group-items {{ isAdminMenuOpen ? '' : 'hidden' }}>
            <a href="/itapiru/admin?entity=groups" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('groups') == 'groups' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('groups') == 'groups' ? 'page' : 'false' }}">
              Grupos
            </a>
            <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
            <a href="/itapiru/admin?entity=subgroups" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('') == 'subgroups' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('') == 'subgroups' ? 'page' : 'false' }}">
              Subgrupos
            </a>
            <span class="db-menu-divider db-menu-divider-sub" aria-hidden="true"></span>
            <a href="/itapiru/admin?entity=cards" hx-boost="false" class="db-menu-item{{ activeSection == 'admin' and adminEntity|default('') == 'cards' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'admin' and adminEntity|default('') == 'cards' ? 'page' : 'false' }}">
              Cards
            </a>
          </div>
        </section>
        <form method="post" action="/itapiru/logout" hx-boost="false" class="db-menu-form">
          <input type="hidden" name="csrf_token" value="{{ csrfToken|default('') }}">
          <button class="db-menu-item" type="submit">Sair</button>
        </form>
      {% else %}
        <span class="db-menu-divider" aria-hidden="true"></span>
        <a href="/itapiru/login" hx-boost="false" class="db-menu-item{{ activeSection == 'login' ? ' is-active' : '' }}" aria-current="{{ activeSection == 'login' ? 'page' : 'false' }}">
          Login
        </a>
      {% endif %}
    </nav>
  </aside>
  <div class="db-sidebar-backdrop" data-sidebar-backdrop aria-hidden="true"></div>

  <main class="db-main" aria-label="Área inicial do dashboard">
    {% include 'components/dashboard-topbar.twig' with {
      lastUpdated: lastUpdated,
      breadcrumbs: [
        { label: 'Dashboard', url: '/itapiru' },
        { label: 'Início' }
      ]
    } %}

    <div id="db-content" class="db-main-body">
      {% include 'components/dashboard-content-header.twig' with {
        breadcrumbs: [
          { label: 'Dashboard', url: '/itapiru' },
          { label: 'Início' }
        ],
        title: 'Visão geral do dashboard',
        subtitle: 'Selecione uma seção no menu lateral para visualizar os cards específicos'
      } %}

      <section class="db-summary" aria-label="Resumo geral do painel">
      <article class="db-card db-card--standard">
        <header class="db-card-head">
          <h3>Total de grupos</h3>
          <span class="db-badge is-ok">Resumo</span>
        </header>
        <p class="db-metric">{{ summary.groups }}</p>
      </article>

      <article class="db-card db-card--standard">
        <header class="db-card-head">
          <h3>Total de cards</h3>
          <span class="db-badge is-ok">Resumo</span>
        </header>
        <p class="db-metric">{{ summary.cards }}</p>
      </article>

      <article class="db-card db-card--standard">
        <header class="db-card-head">
          <h3>Última atualização</h3>
          <span class="db-badge is-ok">Resumo</span>
        </header>
        <p class="db-metric db-metric-small">{{ summary.lastUpdated }}</p>
      </article>
      </section>

      <section class="db-cards" aria-label="Acesso rápido às seções">
        {% for slug, section in sections %}
          <article class="db-card db-card--standard">
            <header class="db-card-head">
              <h3>{{ section.label|label_case }}</h3>
            </header>
            <p class="db-description">{{ section.description }}</p>
            <p class="db-card-link-wrap">
              <a class="db-card-link" href="/itapiru/{{ slug }}">Abrir seção</a>
            </p>
          </article>
        {% endfor %}
      </section>

      {% include 'components/dashboard-footer.twig' with {
        lastUpdated: lastUpdated
      } %}
    </div>
  </main>
</div>
{% endblock %}
